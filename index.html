<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wilcoxon / Rank Tests p-value Calculator</title>

  <style>
    :root{
      /* ERAU-ish */
      --navy1:#003A63;
      --navy2:#002B4A;
      --gold:#FFC72C;

      /* UI neutrals */
      --page:#f4f6f8;
      --card:#ffffff;
      --text:#0b1220;
      --muted:#5b6776;
      --line:#d9e1ea;

      --radius:16px;
      --shadow:0 10px 24px rgba(0,0,0,.08);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      padding:18px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--page);
      color: var(--text);
    }

    .card{
      max-width: 980px;
      margin: 0 auto;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Header: title left, ERAU pill right */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:16px 18px;
  background: var(--navy1);   /* Navy background */
  color: #ffffff;             /* Default white text */
  border-bottom: 4px solid var(--gold);
}

.titlewrap h1{
  margin:0;
  font-size: 20px;
  line-height: 1.2;
  color: #ffffff;             /* Force white title */
  font-weight: 800;
  letter-spacing: .2px;
}

.titlewrap .subtitle{
  margin-top:6px;
  font-size: 13px;
  color: rgba(255,255,255,.85);  /* Slightly softer white */
}
    
.erau-pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 14px;
  border-radius: 999px;
  background: var(--gold);
  color: var(--navy2);
  font-weight: 800;
  letter-spacing: .4px;
  border: 1px solid rgba(0,0,0,.10);
  opacity: 1;
  white-space: nowrap;
}

    .content{
      padding:16px 18px 18px;
    }

    label{
      display:block;
      margin-top: 12px;
      margin-bottom: 6px;
      font-weight: 800;
      color: var(--navy2);
      font-size: 13px;
      letter-spacing: .15px;
    }

    select, textarea{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding:10px 12px;
      font-size: 14px;
      background:#fff;
      outline:none;
    }

    select:focus, textarea:focus{
      border-color: rgba(0,58,99,.55);
      box-shadow: 0 0 0 4px rgba(0,58,99,.12);
    }

    textarea{
      min-height: 105px;
      font-family: var(--mono);
      resize: vertical;
    }

    .row{
      display:flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    .col{ flex: 1 1 360px; }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top: 14px;
      flex-wrap: wrap;
    }

    button{
      appearance:none;
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
      background: var(--navy1);
      color: #fff;
      box-shadow: 0 8px 16px rgba(0,58,99,.18);
    }
    button:hover{ background: var(--navy2); }
    button:active{ transform: translateY(1px); }

    .err{
      margin-top: 10px;
      color: #b00020;
      font-weight: 800;
    }

    .out{
      margin-top: 12px;
      background: #fbfcfe;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
    }

    .out b{ color: var(--navy2); }
    .small{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12.5px;
    }

    .helpbar{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,199,44,.18);
      border: 1px solid rgba(255,199,44,.45);
      color: #3b2f00;
      font-size: 13px;
    }

    /* Keep the whole card looking good when embedded in Canvas */
    @media (max-width: 560px){
      body{ padding: 10px; }
      .header{ align-items:flex-start; flex-direction:column; }
      .erau-pill{ align-self:flex-end; }
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="header">
      <div class="titlewrap">
        <h1>Wilcoxon / Rank-Based p-value Calculator</h1>
        <div class="subtitle">Wilcoxon signed-rank (paired) and Mann–Whitney U (independent)</div>
      </div>

      <div class="erau-pill">Embry-Riddle Aeronautical University</div>
    </div>

    <div class="content">
      <div class="helpbar">
        Enter values separated by commas, spaces, or new lines.
      </div>

      <label>Test type</label>
      <select id="testType">
        <option value="paired">Paired: Wilcoxon signed-rank</option>
        <option value="independent">Independent: Mann–Whitney U (rank-sum)</option>
      </select>

      <label>Alternative hypothesis</label>
      <select id="alt">
        <option value="two-sided">two-sided</option>
        <option value="greater">greater</option>
        <option value="less">less</option>
      </select>

      <div class="row">
        <div class="col">
          <label id="labelX">Sample 1</label>
          <textarea id="x" placeholder="e.g., 12, 15, 18, 22"></textarea>
        </div>
        <div class="col">
          <label id="labelY">Sample 2</label>
          <textarea id="y" placeholder="e.g., 10, 14, 19, 21"></textarea>
        </div>
      </div>

      <div class="actions">
        <button onclick="compute()">Compute</button>
      </div>

      <div id="msg" class="err"></div>
      <div id="result" class="out" style="display:none;"></div>

      <div class="small">
        Notes: p-values use a normal approximation with a continuity correction. For very small samples,
        exact p-values may differ slightly.
      </div>
    </div>
  </div>

<script>
function parseNums(txt){
  return txt
    .replace(/,/g, " ")
    .trim()
    .split(/\s+/)
    .filter(s => s.length)
    .map(s => Number(s))
    .filter(v => Number.isFinite(v));
}

// Error function approximation
function erf(x){
  // Abramowitz-Stegun approximation
  const a1=0.254829592, a2=-0.284496736, a3=1.421413741, a4=-1.453152027, a5=1.061405429;
  const p=0.3275911;
  const sign = x < 0 ? -1 : 1;
  x = Math.abs(x);
  const t = 1.0/(1.0+p*x);
  const y = 1.0 - (((((a5*t + a4)*t + a3)*t + a2)*t + a1)*t)*Math.exp(-x*x);
  return sign*y;
}

function normalCdf(z){
  return 0.5*(1 + erf(z/Math.SQRT2));
}

function rankWithTies(values){
  // returns ranks (1..n) averaged for ties; also tie groups sizes
  const n = values.length;
  const idx = [...Array(n).keys()].sort((i,j)=>values[i]-values[j]);
  const ranks = new Array(n);
  let tieSizes = [];
  let i=0;
  while(i<n){
    let j=i;
    while(j+1<n && values[idx[j+1]]===values[idx[i]]) j++;
    const avgRank = ( (i+1) + (j+1) ) / 2.0;
    const t = j - i + 1;
    if(t>1) tieSizes.push(t);
    for(let k=i;k<=j;k++) ranks[idx[k]]=avgRank;
    i=j+1;
  }
  return {ranks, tieSizes};
}

function computeMannWhitney(x,y,alternative){
  const n1=x.length, n2=y.length;
  const all = x.concat(y);
  const {ranks, tieSizes} = rankWithTies(all);

  // rank sum for group 1
  let R1=0;
  for(let i=0;i<n1;i++) R1 += ranks[i];

  // U1 = R1 - n1(n1+1)/2
  const U1 = R1 - n1*(n1+1)/2;
  const U2 = n1*n2 - U1;
  const U = (alternative==="less") ? U1 : (alternative==="greater" ? U1 : Math.min(U1,U2));

  // mean and variance with tie correction (approx)
  const mu = n1*n2/2;

  // tie correction term
  let tieTerm = 0;
  for(const t of tieSizes) tieTerm += (t*t*t - t);
  const N = n1+n2;
  const sigma2 = (n1*n2/12) * ( (N+1) - tieTerm/(N*(N-1)) );

  const sigma = Math.sqrt(sigma2);

  // continuity correction
  let z;
  if(alternative==="two-sided"){
    z = (U - mu + 0.5) / sigma; // for min(U1,U2) this is a common approximation
    const p = 2 * Math.min(normalCdf(z), 1-normalCdf(z));
    return {statistic: U1, z, pValue: Math.min(1,p), note:`U1=${U1.toFixed(4)}, U2=${U2.toFixed(4)}`};
  } else if(alternative==="greater"){
    z = (U1 - mu - 0.5)/sigma;
    const p = 1 - normalCdf(z);
    return {statistic: U1, z, pValue: p, note:`U2=${U2.toFixed(4)}`};
  } else { // less
    z = (U1 - mu + 0.5)/sigma;
    const p = normalCdf(z);
    return {statistic: U1, z, pValue: p, note:`U2=${U2.toFixed(4)}`};
  }
}

function computeWilcoxonSignedRank(x,y,alternative){
  // differences, drop zeros
  const diffs = x.map((xi,i)=>y[i]-xi);
  let absDiffs=[], signs=[];
  for(const d of diffs){
    if(d===0) continue;
    absDiffs.push(Math.abs(d));
    signs.push(Math.sign(d));
  }
  const n = absDiffs.length;
  if(n===0) throw new Error("All paired differences are zero (no information for signed-rank).");

  const {ranks, tieSizes} = rankWithTies(absDiffs);

  let Wplus=0, Wminus=0;
  for(let i=0;i<n;i++){
    if(signs[i]>0) Wplus += ranks[i];
    else Wminus += ranks[i];
  }

  // Normal approximation with tie correction
  const mu = n*(n+1)/4;

  // tie correction for signed-rank variance
  let tieTerm = 0;
  for(const t of tieSizes) tieTerm += (t*t*t - t);
  const sigma2 = (n*(n+1)*(2*n+1) - tieTerm)/24;
  const sigma = Math.sqrt(sigma2);

  let z, p;
  if(alternative==="two-sided"){
    const T = Math.min(Wplus, Wminus);
    z = (T - mu + 0.5) / sigma;
    p = 2*Math.min(normalCdf(z), 1-normalCdf(z));
    return {statistic: Wplus, z, pValue: Math.min(1,p), note:`W-=${Wminus.toFixed(4)}, n=${n}`};
  } else if(alternative==="greater"){
    // "greater" interpreted as y > x => more positive diffs => large W+
    z = (Wplus - mu - 0.5)/sigma;
    p = 1 - normalCdf(z);
    return {statistic: Wplus, z, pValue: p, note:`W-=${Wminus.toFixed(4)}, n=${n}`};
  } else { // less (y < x)
    z = (Wplus - mu + 0.5)/sigma;
    p = normalCdf(z);
    return {statistic: Wplus, z, pValue: p, note:`W-=${Wminus.toFixed(4)}, n=${n}`};
  }
}

function compute(){
  const testType = document.getElementById("testType").value;
  const alternative = document.getElementById("alt").value;
  const x = parseNums(document.getElementById("x").value);
  const y = parseNums(document.getElementById("y").value);

  const msg = document.getElementById("msg");
  const result = document.getElementById("result");
  msg.textContent = "";
  result.style.display = "none";
  result.innerHTML = "";

  try{
    if(x.length<1 || y.length<1) throw new Error("Please enter numeric values for both samples.");

    let out;
    if(testType==="paired"){
      if(x.length !== y.length) throw new Error("Paired test requires X and Y to have the same number of values.");
      out = computeWilcoxonSignedRank(x,y,alternative);
      result.innerHTML = `
        <b>Paired Wilcoxon signed-rank</b><br/>
        Statistic (W+): ${out.statistic.toFixed(4)}<br/>
        z: ${out.z.toFixed(4)}<br/>
        p-value: <b>${out.pValue.toPrecision(6)}</b><br/>
        <span class="small">${out.note}</span>
      `;
    } else {
      out = computeMannWhitney(x,y,alternative);
      result.innerHTML = `
        <b>Independent Mann–Whitney U (Wilcoxon rank-sum)</b><br/>
        Statistic (U1): ${out.statistic.toFixed(4)}<br/>
        z: ${out.z.toFixed(4)}<br/>
        p-value: <b>${out.pValue.toPrecision(6)}</b><br/>
        <span class="small">${out.note}</span>
      `;
    }
    result.style.display = "block";
  } catch(e){
    msg.textContent = e.message || String(e);
  }
}

// UI label tweak
document.getElementById("testType").addEventListener("change", () => {
  const t = document.getElementById("testType").value;
  document.getElementById("labelX").textContent = (t==="paired") ? "Sample X (paired)" : "Group 1";
  document.getElementById("labelY").textContent = (t==="paired") ? "Sample Y (paired)" : "Group 2";
});
</script>
</body>
</html>
